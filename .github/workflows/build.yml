# Build Script for Apache Ultimate Bad Bot Blocker using GHA
name: CI

defaults:
  run:
    shell: bash

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master
  schedule:
      - cron: '0 10 * * *'
      - cron: '0 22 * * *'

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Install Software
        run: |
          echo "Remove Apache 2.4"
          sudo service apache2 stop
          sudo apt purge apache2 apache2-utils
          sudo apt autoremove
          sudo apache2 -v
          sudo apt -y install dos2unix
          echo "Install ZLib"
          sudo apt-get install build-essential
          sudo wget http://www.zlib.net/zlib-1.2.11.tar.gz
          tar -xvf zlib-1.2.11.tar.gz
          cd zlib-1.2.11/
          ./configure --prefix=/usr/local
          make
          sudo make install
          echo "Install Apache 2.2"
          sudo wget https://github.com/mitchellkrogza/apache-ultimate-bad-bot-blocker/raw/master/.dev-tools/_apache_builds/httpd-2.2.25.tar.gz
          tar -xvf httpd-2.2.25.tar.gz
          cd httpd-2.2.25/
          ./configure --prefix=/usr/local/apache2 --enable-mods-shared=all --enable-deflate --enable-proxy --enable-proxy-balancer --enable-proxy-http
          make
          sudo make install
          apache2 -v
          
